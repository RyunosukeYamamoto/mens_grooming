<div class="container mt-3">
  <ul class="list-unstyled card">
    <li class="media mb-3 card-body">
      <img class="mr-2 rounded" src="<%= gravatar_url(@post.user, { size: 80 }) %>" alt="">
      <div class="media-body">
        <div>
          <%= link_to @post.user.name, user_path(@post.user) %> <span class="text-muted">posted at <%= @post.created_at %></span>
        </div>
        <div>
          <p><%= @post.content %></p>
          <% @post.troubles.each do |trouble| %>
            <span class="badge badge-info"><%= trouble.word %></span>
          <% end %>
          <br>
          <small>カテゴリー：<%= @post.category %> / 年齢：<%= @post.age %></small>
        </div>
      </div>
      <% if @post.user == current_user %>
        <div>
          <%= link_to "Delete", @post, method: :delete, data: { confirm: "You sure?" }, class: 'btn btn-danger btn-sm' %>
        </div>
      <% end %>
    </li>
  </ul>
  
  <% if @post.user == current_user %>
    <% @troubles.each do |trouble| %>
      <% if @post.include_trouble?(trouble) %>
        <%= form_with(model: @post.relationships.find_by(trouble_id: trouble.id), local: true, method: :delete) do |f| %>
          <%= hidden_field_tag :trouble_id, trouble.id %>
          <%= hidden_field_tag :post_id, @post.id %>
          <%= f.submit trouble.word, class: 'btn btn-danger btn-block' %>
        <% end %>
      <% else %>
        <%= form_with(model: @post.relationships.build, local: true) do |f| %>
          <%= hidden_field_tag :trouble_id, trouble.id %>
          <%= hidden_field_tag :post_id, @post.id %>
          <%= f.submit trouble.word, class: 'btn btn-outline-primary btn-block' %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
  
  <% if logged_in? %>
    <%= form_with(model: @trouble, local: true) do |f| %>
      <%= f.label :word, '新しく悩みを作る' %>
      <div class="input-group" style="width: 60%;">
        <%= f.text_field :word, class: "form-control", placeholder: "単語で入力" %>
        <span class="input-group-btn">
          <%= f.submit "作る", class: "btn btn-success" %>
        </span>
      </div>
    <% end %>
  <% end %>
</div>
